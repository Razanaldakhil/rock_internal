<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØµØ®Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ© - AR</title>
    
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Header */
        .header {
            padding: 15px 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #00d4aa;
        }

        .header p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Model Viewer Container */
        .viewer-container {
            flex: 1;
            position: relative;
            min-height: 0;
        }

        model-viewer {
            width: 100%;
            height: 100%;
            background: transparent;
            --poster-color: transparent;
            --progress-bar-color: #00d4aa;
            --progress-bar-height: 4px;
        }

        /* Custom AR Button */
        .ar-button {
            background: linear-gradient(135deg, #00d4aa, #00a085);
            color: #000;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 30px rgba(0, 212, 170, 0.4);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .ar-button:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(0, 212, 170, 0.5);
        }

        .ar-button:active {
            transform: scale(0.98);
        }

        /* AR Not Supported Message */
        .ar-not-supported {
            display: none;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            padding: 15px 25px;
            border-radius: 12px;
            color: #fca5a5;
            font-size: 14px;
            text-align: center;
        }

        /* Instructions */
        .instructions {
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .instructions p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .instructions .hint {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #00d4aa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Hotspots for annotations (optional) */
        .hotspot {
            background: rgba(0, 212, 170, 0.9);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hotspot-annotation {
            background: rgba(0, 0, 0, 0.85);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 150px;
            text-align: center;
            color: white;
        }

        /* Error State */
        .error-message {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .error-message.show {
            display: block;
        }

        .error-message h3 {
            color: #ef4444;
            margin-bottom: 10px;
        }

        .error-message p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        /* Fallback for non-AR devices */
        .view-in-3d {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸª¨ Ø§Ù„ØµØ®Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <p>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø¨ØªÙ‚Ù†ÙŠØ© Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø²</p>
        </div>

        <!-- 3D Viewer -->
        <div class="viewer-container">
            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="spinner"></div>
                <div class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...</div>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage">
                <h3>âš ï¸ Ø®Ø·Ø£</h3>
                <p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</p>
            </div>

            <model-viewer 
                id="rockModel"
                src="rock_internal-v1.glb" 
                ar 
                ar-modes="webxr scene-viewer quick-look"
                ar-scale="auto"
                camera-controls 
                touch-action="pan-y"
                shadow-intensity="1" 
                exposure="1"
                auto-rotate
                auto-rotate-delay="2000"
                rotation-per-second="20deg"
                interaction-prompt="auto"
                interaction-prompt-style="basic"
                loading="eager"
                reveal="auto">
                
                <!-- AR Button -->
                <button slot="ar-button" class="ar-button">
                    <span>ğŸ“¸</span>
                    <span>Ø´Ø§Ù‡Ø¯ Ø¨Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø²</span>
                </button>

                <!-- Fallback if AR not supported -->
                <div id="ar-failure" class="ar-not-supported">
                    <p>âš ï¸ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø² ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</p>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ¯ÙˆÙŠØ±</p>
                </div>

            </model-viewer>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <p>ğŸ‘† Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ¯ÙˆÙŠØ± â€¢ Ø§Ø¶ØºØ· Ù…Ø±ØªÙŠÙ† Ù„Ù„ØªÙƒØ¨ÙŠØ± â€¢ Ù‚Ø±Ù‘Ø¨ Ø£ØµØ§Ø¨Ø¹Ùƒ Ù„Ù„Ø²ÙˆÙ…</p>
            <p class="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± AR Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØµØ®Ø±Ø© ÙÙŠ Ø¨ÙŠØ¦ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</p>
        </div>
    </div>

    <script>
        const modelViewer = document.getElementById('rockModel');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const errorMessage = document.getElementById('errorMessage');
        const arFailure = document.getElementById('ar-failure');

        // Handle model loading
        modelViewer.addEventListener('load', () => {
            console.log('Model loaded successfully');
            loadingOverlay.classList.add('hidden');
        });

        // Handle loading progress
        modelViewer.addEventListener('progress', (event) => {
            const progress = event.detail.totalProgress;
            console.log('Loading progress:', Math.round(progress * 100) + '%');
        });

        // Handle errors
        modelViewer.addEventListener('error', (event) => {
            console.error('Model loading error:', event);
            loadingOverlay.classList.add('hidden');
            errorMessage.classList.add('show');
        });

        // Check AR support
        modelViewer.addEventListener('ar-status', (event) => {
            console.log('AR Status:', event.detail.status);
            
            if (event.detail.status === 'failed') {
                console.log('AR session failed');
                // Don't crash - just show message
                arFailure.style.display = 'block';
            } else if (event.detail.status === 'session-started') {
                console.log('AR session started successfully');
            }
        });

        // Check if AR is supported on this device
        async function checkARSupport() {
            const isARSupported = modelViewer.canActivateAR;
            console.log('AR Supported:', isARSupported);
            
            if (!isARSupported) {
                arFailure.style.display = 'block';
            }
        }

        // Run check when model viewer is ready
        modelViewer.addEventListener('load', checkARSupport);

        // Prevent page zoom on double tap (mobile fix)
        document.addEventListener('touchend', (event) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        let lastTouchEnd = 0;

        // Handle visibility change (when returning from AR)
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                console.log('Page visible again');
                // Force a refresh of the model viewer if needed
                modelViewer.dismissPoster();
            }
        });

        // iOS Safari specific fix
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            // Prevent rubber-band scrolling
            document.body.addEventListener('touchmove', (e) => {
                if (e.target === document.body) {
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // Log for debugging
        console.log('AR modes available:', modelViewer.getAttribute('ar-modes'));
        console.log('User Agent:', navigator.userAgent);
    </script>
</body>
</html>